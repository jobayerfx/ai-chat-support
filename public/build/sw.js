const e="ai-chat-v2.0",t="ai-chat-static-v2.0",n="ai-chat-api-v2.0",a="ai-chat-images-v2.0";importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js"),workbox.precaching.precacheAndRoute([{"revision":"2d094791c49e920331981a2d203b8cdb","url":"registerSW.js"},{"revision":null,"url":"assets/sw-b622e5ba.js"},{"revision":null,"url":"assets/spaSw-1acc9a72.js"},{"revision":null,"url":"assets/app-d503d0e5.js"},{"revision":null,"url":"assets/app-2c43e164.css"},{"revision":"9b54e338b9c5bbb4a170245082c9d6ac","url":"manifest.webmanifest"}]);const o=["/","/signup","/login","/manifest.json","/favicon.ico","/offline.html"],s=["/api/user"];self.addEventListener("install",e=>{console.log("Service Worker: Installing..."),e.waitUntil(Promise.all([caches.open(t).then(e=>(console.log("Service Worker: Caching static assets"),e.addAll(o))),caches.open(t).then(e=>{const t=new Response('\n          <!DOCTYPE html>\n          <html lang="en">\n          <head>\n            <meta charset="UTF-8">\n            <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>Offline - AI Chat Support</title>\n            <style>\n              body {\n                font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n                text-align: center;\n                padding: 2rem;\n                background: #f8fafc;\n                color: #334155;\n              }\n              .container {\n                max-width: 400px;\n                margin: 0 auto;\n                background: white;\n                padding: 2rem;\n                border-radius: 8px;\n                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n              }\n              h1 { color: #4F46E5; margin-bottom: 1rem; }\n              p { margin-bottom: 1.5rem; color: #64748b; }\n              button {\n                background: #4F46E5;\n                color: white;\n                border: none;\n                padding: 0.75rem 1.5rem;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: 500;\n              }\n              button:hover { background: #4338ca; }\n            </style>\n          </head>\n          <body>\n            <div class="container">\n              <h1>ðŸ¤– You\'re Offline</h1>\n              <p>AI Chat Support is currently unavailable. Please check your internet connection and try again.</p>\n              <button onclick="window.location.reload()">Try Again</button>\n            </div>\n          </body>\n          </html>\n        ',{headers:{"Content-Type":"text/html"}});return e.put("/offline.html",t)})]).then(()=>(console.log("Service Worker: Installation complete"),self.skipWaiting())))}),self.addEventListener("activate",o=>{console.log("Service Worker: Activating..."),o.waitUntil(Promise.all([caches.keys().then(o=>Promise.all(o.map(o=>{if(![e,t,n,a].includes(o))return console.log("Service Worker: Deleting old cache:",o),caches.delete(o)}))),self.clients.claim()]).then(()=>{console.log("Service Worker: Activation complete")}))}),self.addEventListener("fetch",e=>{const{request:o}=e,i=new URL(o.url);"GET"===o.method&&(i.pathname.startsWith("/api/")?e.respondWith(async function(e){const t=new URL(e.url),a=e.url;try{const o=await fetch(e.clone());if(o.ok&&"GET"===e.method){const e=await caches.open(n);if(s.some(e=>t.pathname.startsWith(e))){const t=new Response(o.clone().body,{status:o.status,statusText:o.statusText,headers:{...Object.fromEntries(o.headers.entries()),"sw-cache-time":Date.now().toString(),"sw-cache-strategy":"network-first"}});e.put(a,t)}}return o}catch(o){console.log("Service Worker: Network failed for API request, trying cache");const e=await caches.match(a);if(e){return new Response(e.body,{status:e.status,statusText:e.statusText,headers:{...Object.fromEntries(e.headers.entries()),"sw-cache-hit":"true"}})}return new Response(JSON.stringify({error:"Offline",message:"This feature requires an internet connection"}),{status:503,headers:{"Content-Type":"application/json"}})}}(o)):"image"===o.destination||i.pathname.match(/\.(png|jpg|jpeg|gif|svg|webp)$/)?e.respondWith(async function(e){const t=await caches.open(a),n=await t.match(e);if(n){const e=n.headers.get("sw-cache-time");if(Date.now()-parseInt(e||"0")<864e5)return n}try{const n=await fetch(e);if(n.ok){const a=new Response(n.clone().body,{status:n.status,statusText:n.statusText,headers:{...Object.fromEntries(n.headers.entries()),"sw-cache-time":Date.now().toString()}});t.put(e,a)}return n}catch(o){return n||new Response("",{status:404,headers:{"Content-Type":"image/svg+xml"}})}}(o)):e.respondWith(async function(e){const n=await caches.open(t),a=await n.match(e);if(a)return a;try{const t=await fetch(e);return t.ok&&n.put(e,t.clone()),t}catch(o){if("navigate"===e.mode){return await n.match("/offline.html")||new Response("Offline",{status:503})}return new Response("Network Error",{status:503})}}(o)))}),self.addEventListener("sync",e=>{console.log("Service Worker: Background sync triggered:",e.tag),"background-sync"===e.tag&&e.waitUntil(async function(){console.log("Service Worker: Performing background sync")}())}),self.addEventListener("push",e=>{if(e.data){const t=e.data.json(),n={body:t.body,icon:"/favicon.ico",badge:"/favicon.ico",vibrate:[100,50,100],data:t.data||{},actions:t.actions||[]};e.waitUntil(self.registration.showNotification(t.title||"AI Chat Support",n))}}),self.addEventListener("notificationclick",e=>{e.notification.close();const t=e.action||"/dashboard";e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(e=>{for(let t of e)if(t.url.includes(self.location.origin)&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow(t)}))}),self.addEventListener("message",e=>{e.data&&"CLEAN_CACHE"===e.data.type&&async function(){const e=await caches.open(a),t=await e.keys(),n=6048e5;await Promise.all(t.map(async t=>{const a=await e.match(t);if(a){const o=a.headers.get("sw-cache-time");Date.now()-parseInt(o||"0")>n&&await e.delete(t)}})),console.log("Service Worker: Cache cleanup completed")}()});
