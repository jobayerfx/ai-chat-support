const t="react-spa-v1.0",e="react-static-v1.0",n="react-images-v1.0",a="react-fonts-v1.0",s=["/build/manifest.json","/build/assets/"],o=["/api/","/sanctum/","/login","/logout","/register","/password/"],i=["/api/knowledge/search"],c=["/api/user","/api/knowledge"],r=["/","/dashboard","/knowledge","/settings","/profile","/onboarding"];self.addEventListener("install",t=>{t.waitUntil(Promise.all([caches.open(e).then(t=>t.addAll(s).catch(t=>{})),caches.open(e).then(t=>t.put("/offline.html",new Response("\n          <!DOCTYPE html>\n          <html lang=\"en\">\n          <head>\n            <meta charset=\"UTF-8\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n            <title>Offline - AI Chat Support</title>\n            <style>\n              body {\n                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                text-align: center;\n                padding: 2rem;\n                background: #f8fafc;\n                color: #334155;\n                margin: 0;\n              }\n              .container {\n                max-width: 400px;\n                margin: 0 auto;\n                background: white;\n                padding: 2rem;\n                border-radius: 8px;\n                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n              }\n              h1 {\n                color: #4F46E5;\n                margin-bottom: 1rem;\n                font-size: 1.5rem;\n              }\n              p {\n                margin-bottom: 1.5rem;\n                color: #64748b;\n                line-height: 1.6;\n              }\n              button {\n                background: #4F46E5;\n                color: white;\n                border: none;\n                padding: 0.75rem 1.5rem;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: 500;\n                font-size: 1rem;\n              }\n              button:hover { background: #4338ca; }\n              .status {\n                color: #dc2626;\n                font-weight: 500;\n                margin-bottom: 1rem;\n              }\n            </style>\n          </head>\n          <body>\n            <div class=\"container\">\n              <h1>ðŸ”Œ You're Offline</h1>\n              <p id=\"status\">Checking connection...</p>\n              <p>Please check your internet connection and try again.</p>\n              <button onclick=\"window.location.reload()\">Try Again</button>\n            </div>\n            <script>\n              // Check online status\n              function updateOnlineStatus() {\n                const status = document.getElementById('status');\n                if (navigator.onLine) {\n                  status.textContent = 'You appear to be online. The app may be experiencing issues.';\n                  status.style.color = '#d97706';\n                } else {\n                  status.textContent = 'No internet connection detected.';\n                  status.style.color = '#dc2626';\n                }\n              }\n\n              window.addEventListener('online', updateOnlineStatus);\n              window.addEventListener('offline', updateOnlineStatus);\n              updateOnlineStatus();\n            <\/script>\n          </body>\n          </html>\n        ",{headers:{"Content-Type":"text/html"}})))]).then(()=>self.skipWaiting()))}),self.addEventListener("activate",s=>{s.waitUntil(Promise.all([caches.keys().then(s=>Promise.all(s.map(s=>{if(![t,e,n,a].includes(s))return caches.delete(s)}))),self.clients.claim()]).then(()=>{}))}),self.addEventListener("fetch",t=>{const{request:s}=t,h=new URL(s.url);"GET"===s.method&&h.origin.includes(self.location.origin)&&(o.some(t=>h.pathname.startsWith(t))||(!function(t){const e=new URL(t.url);return e.pathname.match(/\.(js|css|map)$/)}(s)?!function(t){const e=new URL(t.url);return e.pathname.match(/\.(png|jpg|jpeg|gif|svg|webp|ico)$/)}(s)?!function(t){const e=new URL(t.url);return e.pathname.match(/\.(woff|woff2|ttf|eot)$/)}(s)?!function(t){const e=new URL(t.url);return e.pathname.startsWith("/api/")}(s)?function(t){var e;return(null==(e=t.headers.get("accept"))?void 0:e.includes("text/html"))||"document"===t.destination}(s)&&t.respondWith(async function(t){const n=new URL(t.url);try{const a=await fetch(t);if(a.ok&&r.some(t=>n.pathname.startsWith(t))){(await caches.open(e)).put(t,a.clone())}return a}catch(a){const s=await caches.open(e),o=await s.match(t);if(o)return o;if(r.some(t=>n.pathname.startsWith(t))){const t=await s.match("/");if(t)return t}if("navigate"===t.mode){return await s.match("/offline.html")||new Response("Offline",{status:503})}return new Response("Network Error",{status:503})}}(s)):t.respondWith(async function(t){var e;const n=new URL(t.url);if(t.url,"POST"===t.method||(null==(e=t.headers.get("cookie"))?void 0:e.includes("session")))return fetch(t);const a=i.some(t=>n.pathname.startsWith(t)),s=c.some(t=>n.pathname.startsWith(t));return a?async function(t,e){const n=await caches.open("api-cache"),a=await n.match(t);if(a){const t=a.headers.get("sw-cache-time");if(Date.now()-parseInt(t||"0")<e)return a}try{const e=await fetch(t);if(e.ok){const a=new Response(e.clone().body,{status:e.status,statusText:e.statusText,headers:{...Object.fromEntries(e.headers.entries()),"sw-cache-time":Date.now().toString(),"sw-cache-strategy":"time-based"}});n.put(t,a)}return e}catch(s){return a||new Response(JSON.stringify({error:"Network Error",message:"Unable to fetch data. Please check your connection."}),{status:503,headers:{"Content-Type":"application/json"}})}}(t,3e5):s?async function(t){const e=await caches.open("api-cache"),n=await e.match(t),a=fetch(t).then(n=>{if(n.ok){const a=new Response(n.clone().body,{status:n.status,statusText:n.statusText,headers:{...Object.fromEntries(n.headers.entries()),"sw-cache-time":Date.now().toString(),"sw-cache-strategy":"stale-while-revalidate"}});e.put(t,a)}return n}).catch(t=>null);if(n)return n;try{return await a||new Response(JSON.stringify({error:"Network Error",message:"Unable to fetch data. Please check your connection."}),{status:503,headers:{"Content-Type":"application/json"}})}catch(s){return new Response(JSON.stringify({error:"Network Error",message:"Unable to fetch data. Please check your connection."}),{status:503,headers:{"Content-Type":"application/json"}})}}(t):async function(t){try{const e=await fetch(t);if(e.ok&&"GET"===t.method){const n=await caches.open("api-cache"),a=new Response(e.clone().body,{status:e.status,statusText:e.statusText,headers:{...Object.fromEntries(e.headers.entries()),"sw-cache-time":Date.now().toString(),"sw-cache-strategy":"network-first"}});n.put(t,a)}return e}catch(e){const n=await caches.open("api-cache"),a=await n.match(t);return a||new Response(JSON.stringify({error:"Offline",message:"This feature requires an internet connection"}),{status:503,headers:{"Content-Type":"application/json"}})}}(t)}(s)):t.respondWith(async function(t){const e=await caches.open(a),n=await e.match(t);if(n)return n;try{const n=await fetch(t);return n.ok&&e.put(t,n.clone()),n}catch(s){return new Response("Font not available",{status:503})}}(s)):t.respondWith(async function(t){const e=await caches.open(n),a=await e.match(t);if(a){const t=a.headers.get("sw-cache-time");if(Date.now()-parseInt(t||"0")<6048e5)return a}try{const n=await fetch(t);if(n.ok){const a=new Response(n.clone().body,{status:n.status,statusText:n.statusText,headers:{...Object.fromEntries(n.headers.entries()),"sw-cache-time":Date.now().toString()}});e.put(t,a)}return n}catch(s){return a||new Response("",{status:404,headers:{"Content-Type":"image/svg+xml"}})}}(s)):t.respondWith(async function(t){const n=await caches.open(e),a=await n.match(t);if(a)return a;try{const e=await fetch(t);return e.ok&&n.put(t,e.clone()),e}catch(s){return new Response("Asset not available",{status:503})}}(s))))}),self.addEventListener("message",t=>{t.data&&"SKIP_WAITING"===t.data.type&&self.skipWaiting(),t.data&&"CLEAN_CACHE"===t.data.type&&async function(){const t=await caches.open(n),e=await t.keys(),a=6048e5;await Promise.all(e.map(async e=>{const n=await t.match(e);if(n){const s=n.headers.get("sw-cache-time");Date.now()-parseInt(s||"0")>a&&await t.delete(e)}}))}()}),self.addEventListener("push",t=>{if(t.data){const e=t.data.json(),n={body:e.body||"New notification",icon:"/favicon.ico",badge:"/favicon.ico",vibrate:[100,50,100],data:e.data||{},tag:e.tag||"general",requireInteraction:e.requireInteraction||!1};t.waitUntil(self.registration.showNotification(e.title||"AI Chat Support",n))}}),self.addEventListener("notificationclick",t=>{t.notification.close();const e=t.action||"/dashboard";t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(t=>{for(let e of t)if(e.url.includes(self.location.origin)&&"focus"in e)return e.focus();if(clients.openWindow)return clients.openWindow(e)}))});
