const t="ai-chat-v2.0",e="ai-chat-static-v2.0",n="ai-chat-api-v2.0",a="ai-chat-images-v2.0";importScripts("https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-sw.js"),workbox.precaching.precacheAndRoute(self.__WB_MANIFEST);const s=["/","/signup","/login","/manifest.json","/favicon.ico","/offline.html"],i=["/api/user"];self.addEventListener("install",t=>{t.waitUntil(Promise.all([caches.open(e).then(t=>t.addAll(s)),caches.open(e).then(t=>{const e=new Response('\n          <!DOCTYPE html>\n          <html lang="en">\n          <head>\n            <meta charset="UTF-8">\n            <meta name="viewport" content="width=device-width, initial-scale=1.0">\n            <title>Offline - AI Chat Support</title>\n            <style>\n              body {\n                font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif;\n                text-align: center;\n                padding: 2rem;\n                background: #f8fafc;\n                color: #334155;\n              }\n              .container {\n                max-width: 400px;\n                margin: 0 auto;\n                background: white;\n                padding: 2rem;\n                border-radius: 8px;\n                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);\n              }\n              h1 { color: #4F46E5; margin-bottom: 1rem; }\n              p { margin-bottom: 1.5rem; color: #64748b; }\n              button {\n                background: #4F46E5;\n                color: white;\n                border: none;\n                padding: 0.75rem 1.5rem;\n                border-radius: 6px;\n                cursor: pointer;\n                font-weight: 500;\n              }\n              button:hover { background: #4338ca; }\n            </style>\n          </head>\n          <body>\n            <div class="container">\n              <h1>ðŸ¤– You\'re Offline</h1>\n              <p>AI Chat Support is currently unavailable. Please check your internet connection and try again.</p>\n              <button onclick="window.location.reload()">Try Again</button>\n            </div>\n          </body>\n          </html>\n        ',{headers:{"Content-Type":"text/html"}});return t.put("/offline.html",e)})]).then(()=>self.skipWaiting()))}),self.addEventListener("activate",s=>{s.waitUntil(Promise.all([caches.keys().then(s=>Promise.all(s.map(s=>{if(![t,e,n,a].includes(s))return caches.delete(s)}))),self.clients.claim()]).then(()=>{}))}),self.addEventListener("fetch",t=>{const{request:s}=t,o=new URL(s.url);"GET"===s.method&&(o.pathname.startsWith("/api/")?t.respondWith(async function(t){const e=new URL(t.url),a=t.url;try{const s=await fetch(t.clone());if(s.ok&&"GET"===t.method){const t=await caches.open(n);if(i.some(t=>e.pathname.startsWith(t))){const e=new Response(s.clone().body,{status:s.status,statusText:s.statusText,headers:{...Object.fromEntries(s.headers.entries()),"sw-cache-time":Date.now().toString(),"sw-cache-strategy":"network-first"}});t.put(a,e)}}return s}catch(s){const t=await caches.match(a);if(t){return new Response(t.body,{status:t.status,statusText:t.statusText,headers:{...Object.fromEntries(t.headers.entries()),"sw-cache-hit":"true"}})}return new Response(JSON.stringify({error:"Offline",message:"This feature requires an internet connection"}),{status:503,headers:{"Content-Type":"application/json"}})}}(s)):"image"===s.destination||o.pathname.match(/\.(png|jpg|jpeg|gif|svg|webp)$/)?t.respondWith(async function(t){const e=await caches.open(a),n=await e.match(t);if(n){const t=n.headers.get("sw-cache-time");if(Date.now()-parseInt(t||"0")<864e5)return n}try{const n=await fetch(t);if(n.ok){const a=new Response(n.clone().body,{status:n.status,statusText:n.statusText,headers:{...Object.fromEntries(n.headers.entries()),"sw-cache-time":Date.now().toString()}});e.put(t,a)}return n}catch(s){return n||new Response("",{status:404,headers:{"Content-Type":"image/svg+xml"}})}}(s)):t.respondWith(async function(t){const n=await caches.open(e),a=await n.match(t);if(a)return a;try{const e=await fetch(t);return e.ok&&n.put(t,e.clone()),e}catch(s){if("navigate"===t.mode){return await n.match("/offline.html")||new Response("Offline",{status:503})}return new Response("Network Error",{status:503})}}(s)))}),self.addEventListener("sync",t=>{"background-sync"===t.tag&&t.waitUntil(async function(){}())}),self.addEventListener("push",t=>{if(t.data){const e=t.data.json(),n={body:e.body,icon:"/favicon.ico",badge:"/favicon.ico",vibrate:[100,50,100],data:e.data||{},actions:e.actions||[]};t.waitUntil(self.registration.showNotification(e.title||"AI Chat Support",n))}}),self.addEventListener("notificationclick",t=>{t.notification.close();const e=t.action||"/dashboard";t.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then(t=>{for(let e of t)if(e.url.includes(self.location.origin)&&"focus"in e)return e.focus();if(clients.openWindow)return clients.openWindow(e)}))}),self.addEventListener("message",t=>{t.data&&"CLEAN_CACHE"===t.data.type&&async function(){const t=await caches.open(a),e=await t.keys(),n=6048e5;await Promise.all(e.map(async e=>{const a=await t.match(e);if(a){const s=a.headers.get("sw-cache-time");Date.now()-parseInt(s||"0")>n&&await t.delete(e)}}))}()});
